{% extends "base.html" %}
{% block title %}Activity · {{ activity.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">{{ activity.title }}</h2>
    <div class="d-flex gap-2">
      <a href="{% url 'activity_edit' activity.pk %}" class="btn btn-outline-primary">Edit</a>

      {% if activity.status != "completed" %}
      <form method="post" action="{% url 'activity_complete' activity.pk %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Mark Completed</button>
      </form>
      {% endif %}

      {% if user.is_superuser or activity.assigned_to == user %}
      <form method="post" action="{% url 'activity_delete' activity.pk %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
      {% endif %}

      <a href="{% url 'activity_list' %}" class="btn btn-outline-secondary">Back</a>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <dl class="row mb-0">
        <dt class="col-sm-3">Type</dt>
        <dd class="col-sm-9">{{ activity.get_activity_type_display }}</dd>

        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9">
          {% if activity.status == "completed" %}
            <span class="badge bg-success">Completed</span>
          {% elif activity.status == "planned" %}
            <span class="badge bg-info text-dark">Planned</span>
          {% elif activity.status == "cancelled" %}
            <span class="badge bg-secondary">Cancelled</span>
          {% else %}
            {{ activity.get_status_display }}
          {% endif %}
        </dd>

        <dt class="col-sm-3">Contact</dt>
        <dd class="col-sm-9">
          {% if activity.contact %}
            {{ activity.contact.full_name }} ({{ activity.contact.company.name }})
          {% else %}
            —
          {% endif %}
        </dd>

        <dt class="col-sm-3">Deal</dt>
        <dd class="col-sm-9">
          {% if activity.deal %}
            {{ activity.deal.title }} ({{ activity.deal.company.name }})
          {% else %}
            —
          {% endif %}
        </dd>

        <dt class="col-sm-3">Assigned To</dt>
        <dd class="col-sm-9">{{ activity.assigned_to.get_full_name|default:activity.assigned_to.username }}</dd>

        <dt class="col-sm-3">Due Date</dt>
        <dd class="col-sm-9">{{ activity.due_date|date:"M d, Y H:i" }}</dd>

        <dt class="col-sm-3">Completed At</dt>
        <dd class="col-sm-9">
          {% if activity.completed_at %}
            {{ activity.completed_at|date:"M d, Y H:i" }}
          {% else %}
            —
          {% endif %}
        </dd>

        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9">{{ activity.description|linebreaksbr|default:"No description" }}</dd>

        <dt class="col-sm-3">Created / Updated</dt>
        <dd class="col-sm-9">
          {{ activity.created_at|date:"M d, Y H:i" }} /
          {{ activity.updated_at|date:"M d, Y H:i" }}
        </dd>
      </dl>
    </div>
  </div>
</div>
{% endblock %}
